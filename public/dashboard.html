<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO & Social Media Tags -->
    <title>Dashboard - Bharat Boost Hub</title>
    <meta name="description" content="Manage your video promotions, track your stats, and grow your YouTube channel with the Bharat Boost Hub dashboard.">
    <meta name="keywords" content="youtube promotion, dashboard, grow youtube, video stats">
    <link rel="canonical" href="https://bharat-boost-hub.web.app/dashboard.html"> <!-- Final Domain -->
    <!-- Open Graph / Facebook -->
    <meta property="og:title" content="Dashboard - Bharat Boost Hub">
    <meta property="og:description" content="Manage your video promotions and grow your YouTube channel.">
    <!-- Twitter -->
    <meta property="twitter:title" content="Dashboard - Bharat Boost Hub">
    <meta property="twitter:description" content="Manage your video promotions and grow your YouTube channel.">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

    <!-- Your Firebase SDK and Configuration -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyBOnW5Mv5YYquR1I9_Nn1ViprMVVOoubbM",
        authDomain: "bharat-boost-hub.firebaseapp.com",
        projectId: "bharat-boost-hub",
        storageBucket: "bharat-boost-hub.appspot.com",
        messagingSenderId: "1047323522415",
        appId: "1:1047323522415:web:4972c0bce15ae7253de49a",
        measurementId: "G-71J9272S91"
      };
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const db = firebase.firestore();
    </script>
    
    <style> 
        body { font-family: 'Inter', sans-serif; background-color: #f8f9fa; } 
        .card { background-color: white; border-radius: 0.75rem; box-shadow: 0 4px 15px -1px rgb(0 0 0 / 0.05); border: 1px solid #e5e7eb; } 
        .btn { transition: all 0.2s ease-in-out; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgb(0 0 0 / 0.1); }
    </style>
</head>
<body class="antialiased">
    <header class="bg-white shadow-sm sticky top-0 z-50"><div class="container mx-auto px-4 sm:px-6 py-3"><div class="flex justify-between items-center"><div class="flex items-center space-x-3"><div class="bg-red-600 text-white w-10 h-10 rounded-full flex items-center justify-center font-extrabold text-xl">B</div><div><h1 class="text-gray-800 text-lg font-bold">Bharat Boost Hub</h1></div></div><div class="flex items-center space-x-4"><div class="bg-amber-400 text-amber-900 px-3 py-1 rounded-full flex items-center space-x-1 text-sm font-semibold"><span class="material-symbols-outlined !text-base">monetization_on</span><span id="coin-balance">...</span></div><button id="logout-btn" class="text-gray-600 hover:text-red-600 font-medium flex items-center space-x-1"><span class="material-symbols-outlined">logout</span><span>Logout</span></button></div></div></div></header>

    <main class="container mx-auto px-4 sm:px-6 py-8">
        <section id="welcome-message" class="mb-8"><h2 class="text-2xl font-bold text-gray-800">Welcome...</h2></section>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="space-y-6">
                <div class="card p-6"><h3 class="text-lg font-semibold text-gray-800 mb-4">Upload Your Video</h3><a href="upload.html" class="btn w-full block text-center bg-red-600 text-white py-2.5 rounded-lg font-semibold hover:bg-red-700">Promote Video (Cost: 5 Coins)</a></div>
                <div class="card p-6"><h3 class="text-lg font-semibold text-gray-800 mb-4">Earn Coins</h3><a href="earn.html" class="btn w-full block text-center bg-green-500 text-white py-2.5 rounded-lg font-semibold hover:bg-green-600">Start Earning Coins</a></div>
            </div>
            <div class="card p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">My Promoted Videos</h3>
                <div id="loading-state" class="text-center p-8"><svg class="animate-spin h-8 w-8 text-red-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><p class="mt-2 text-sm text-gray-500">Loading videos...</p></div>
                <div id="my-videos-list" class="space-y-3"></div>
                <div id="no-videos-message" class="hidden text-center border-2 border-dashed border-gray-300 p-8 rounded-lg"><span class="material-symbols-outlined text-gray-400 !text-5xl">cloud_upload</span><p class="mt-2 font-semibold text-gray-700">No videos promoted yet</p></div>
            </div>
        </div>
    </main>

    <script>
        const coinBalanceEl = document.getElementById('coin-balance');
        const myVideosList = document.getElementById('my-videos-list');
        const noVideosMessage = document.getElementById('no-videos-message');
        const welcomeMessage = document.getElementById('welcome-message');
        const logoutBtn = document.getElementById('logout-btn');
        const loadingState = document.getElementById('loading-state');

        auth.onAuthStateChanged(user => {
            if (user) {
                welcomeMessage.innerHTML = `Welcome back, <span class="text-red-600">${user.displayName || 'Creator'}</span>! ðŸ‘‹`;
                loadUserData(user);
            } else {
                window.location.href = 'index.html'; // Or your login page
            }
        });
        
        logoutBtn.addEventListener('click', () => {
            auth.signOut().then(() => {
                window.location.href = 'index.html'; // Or your login page
            });
        });

        async function loadUserData(user) {
            const userDocRef = db.collection('users').doc(user.uid);
            const userDoc = await userDocRef.get();

            if (!userDoc.exists) {
                await userDocRef.set({ coins: 5, email: user.email, displayName: user.displayName });
                coinBalanceEl.textContent = 5;
            } else {
                coinBalanceEl.textContent = userDoc.data().coins;
            }

            const videosSnapshot = await db.collection('videos').where('uploaderId', '==', user.uid).orderBy('createdAt', 'desc').get();
            
            loadingState.classList.add('hidden');
            
            if (videosSnapshot.empty) {
                noVideosMessage.classList.remove('hidden');
            } else {
                myVideosList.innerHTML = '';
                videosSnapshot.forEach(doc => {
                    const videoData = doc.data();
                    const videoId = getYouTubeVideoId(videoData.url);
                    if (videoId) {
                        myVideosList.innerHTML += `
                            <a href="${videoData.url}" target="_blank" class="flex items-center space-x-4 p-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition duration-300">
                                <img src="https://i3.ytimg.com/vi/${videoId}/default.jpg" class="w-24 h-16 object-cover rounded-md flex-shrink-0" alt="Video Thumbnail">
                                <p class="text-sm text-gray-800 truncate">${videoData.url}</p>
                            </a>`;
                    }
                });
            }
        }

        function getYouTubeVideoId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }
    </script>
</body>
</html>
