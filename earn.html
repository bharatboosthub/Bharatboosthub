<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Earn Coins - Bharat Boost Hub</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <style> body { font-family: 'Inter', sans-serif; background-color: #f9fafb; } </style>
</head>
<body class="min-h-screen flex flex-col justify-center items-center">
  <div class="bg-white p-8 rounded-lg shadow-lg max-w-xl text-center">
    <h1 class="text-2xl font-bold mb-4">Watch and Earn</h1>
    <p class="text-gray-600 mb-6">Watch a video and earn <strong>5 coins</strong>!</p>
    <div id="video-container" class="mb-6"></div>
    <button id="watchBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded shadow transition">Watch Now</button>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>

  <script>
    // âœ… Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyBOnW5Mv5YYquR119_Nn1ViprMVV00ubbM",
      authDomain: "bharat-boost-hub.firebaseapp.com",
      projectId: "bharat-boost-hub",
    };
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const currentUserId = localStorage.getItem('currentUserId') || 'anonymous';
    let currentVideo = null;

    async function loadRandomVideo() {
      const snapshot = await db.collection('promotedVideos').get();
      const allVideos = snapshot.docs.map(doc => doc.data());
      const filteredVideos = allVideos.filter(v => v.uploaderId !== currentUserId);

      if (filteredVideos.length === 0) {
        document.getElementById('video-container').innerHTML = '<p class="text-red-600">No videos available right now.</p>';
        document.getElementById('watchBtn').disabled = true;
        return;
      }

      currentVideo = filteredVideos[Math.floor(Math.random() * filteredVideos.length)];
      const videoId = extractVideoId(currentVideo.url);
      document.getElementById('video-container').innerHTML = `
        <iframe width="100%" height="315" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen></iframe>
      `;
    }

    document.getElementById('watchBtn').addEventListener('click', () => {
      if (!currentVideo) return;

      const currentCoins = parseInt(localStorage.getItem('userCoins') || '0');
      localStorage.setItem('userCoins', currentCoins + 5);
      window.location.href = currentVideo.url;
    });

    function extractVideoId(url) {
      const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
      const match = url.match(regExp);
      return (match && match[2].length === 11) ? match[2] : null;
    }

    loadRandomVideo();
  </script>
</body>
</html>
